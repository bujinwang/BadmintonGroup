# 🏸 羽毛球配对管理应用 - PRD（最终版）

## 📋 文档信息
- **项目名称**: 羽毛球配对管理应用
- **版本**: 2.0（最终版）
- **创建日期**: Aug 22, 2025
- **最后更新**: Aug 22, 2025
- **状态**: 需求确认

## 🎯 产品概述

### 产品愿景
打造一个智能、易用的羽毛球配对管理工具，解决羽毛球群配对轮换的公平性问题，包含完整的轮换管理和结果记录功能。

### 核心价值
1. **公平性**: 智能轮换算法确保每位球员都有平等的上场机会
2. **实用性**: 专注2局制羽毛球的实际需求
3. **智能化**: 自动轮换、智能配对
4. **权限化**: 局主管理，队员参与

## 🎯 核心轮换规则

### 1. 轮换触发条件
**打完一场（2-3局）必须有人下场**

#### 1.1 轮换人数规则
- **5人时** → **下1人**
- **6人时** → **下2人**
- **7人时** → **下3人**
- **8人以上** → 根据场地数动态调整

### 2. 下场优先级算法
#### 2.1 主要规则：打得多的人优先下
- 按已打局数从高到低排序
- 选择打得最多的球员下场

#### 2.2 辅助规则：轮流下场
- 如果场上球员打球局数相近
- 优先让上一场没下的人下场
- 确保轮换的公平性
- 主动歇一下的球员不参与轮换
- 主动离场的球员不参与轮换

## 🔐 权限管理设计

### 3. 权限分层架构
#### 3.1 局主权限（最高权限）
- ✅ 创建/编辑/删除局信息
- ✅ 添加/删除球员
- ✅ 管理轮换规则和设置
- ✅ 审核/修改比赛结果记录
- ✅ 管理歇一下和离场申请
- ✅ 分享局信息

#### 3.2 队员权限（基础权限）
- ✅ 查看局信息和轮换状态
- ✅ 记录自己参与的比赛大分（2-0、2-1）
- ✅ 申请歇一下（暂停1局）
- ✅ 申请离场（永久离开）
- ✅ 查看个人统计数据

## 🏆 大分记录权限

### 8. 记录权限控制
#### 8.1 记录权限
- **队员**: 可以记录自己参与的比赛结果
- **局主**: 可以记录任何比赛的结果，可以修改所有记录

#### 8.2 记录流程
1. 队员完成比赛后，主动记录大分（2-0或2-1）
2. 系统验证：检查是否为比赛参与者
3. 记录提交后，局主可以审核或修改
4. 审核通过后，更新统计数据

## 🎮 核心功能模块

### 1. 智能轮换系统（核心功能）
#### 1.1 轮换算法
- ✅ 基于打球次数的优先轮换
- ✅ 智能轮流机制（打球次数相同时）
- ✅ 自动计算轮换人数
- ✅ 支持手动调整

#### 1.2 状态显示
- ✅ 实时显示打球局数
- ✅ 建议下场球员高亮
- ✅ 轮换队列可视化
- ✅ 公平性统计

### 2. 配对管理功能
#### 2.1 智能配对
- ✅ 基于历史配合数据
- ✅ 考虑球员实力匹配
- ✅ 自动生成最佳配对方案

#### 2.2 配对调整
- ✅ 拖拽调整球员位置
- ✅ 快速配对方案（轮换配对、平衡实力、随机配对）
- ✅ 配对历史记录和回滚

### 3. 球员状态管理
#### 3.1 歇一下功能
- ✅ 暂停1局比赛，不参与下一场轮换
- ✅ 任何人可申请，局主批准
- ✅ 15分钟默认时长
- ✅ 歇一下期间从轮换队列移除
- ✅ 自动取消歇一下状态（时间到自动恢复）

#### 3.2 离场功能
- ✅ 球员申请离场
- ✅ 局主批准流程
- ✅ 离场统计记录
- ✅ 离场后不参与后续轮换

### 4. 组局系统
#### 4.1 局创建管理
- ✅ 任何人可创建局
- ✅ 局名格式：城市+日期+时间
- ✅ 冲突检测和姓氏区分

#### 4.2 局信息设置
- ✅ 时间、地点、最大人数
- ✅ 水平要求、费用
- ✅ 详细说明

#### 4.3 局分享功能
- ✅ 微信群分享（中文）
- ✅ WhatsApp分享（英文翻译）
- ✅ 局链接生成

### 5. 场地管理
#### 5.1 场地配置
- ✅ 1-4场地可配置
- ✅ 每场地最大人数
- ✅ 场地状态管理

#### 5.2 动态轮换规则
- ✅ 根据场地数自动调整轮换人数
- ✅ 跨场地平衡分配
- ✅ 场地使用监控

### 6. 数据管理
#### 6.1 云数据同步
- ✅ 实时多设备同步
- ✅ 离线操作支持
- ✅ 数据冲突解决

#### 6.2 数据持久化
- ✅ 云端自动备份
- ✅ 本地数据导出
- ✅ 数据恢复功能

### 7. 大分结果记录
#### 7.1 快速记录
- ✅ 2-0（横扫获胜）
- ✅ 2-1（决胜局获胜）
- ✅ 权限验证

#### 7.2 统计功能
- ✅ 个人胜负统计
- ✅ 胜率计算
- ✅ 基础排名

## 📊 数据模型设计

### 核心实体
1. **用户（User）**: ID、姓名、角色、设备ID
2. **局（Session）**: ID、局名、组织者、时间、地点、状态
3. **球员（Player）**: ID、姓名、胜场、负场、积分、打球局数
4. **配对（Partnership）**: ID、球员1、球员2、胜场、负场、配合局数
5. **比赛（Game）**: ID、局ID、大分结果、胜者、时长
6. **场地（Court）**: ID、名称、状态、容量

## 🚀 实施计划（详细分阶段执行）

### Phase 0: 简化版基础架构 ✅ (已完成)
#### 0.1 技术栈搭建
- ✅ Node.js/Express 后端服务
- ✅ PostgreSQL 数据库 + Prisma ORM
- ✅ React Native 移动端应用
- ✅ 简化版数据模型（无认证）
- ✅ Docker 容器化环境

#### 0.2 第一版核心功能
- ✅ 无用户注册/登录
- ✅ 基于分享链接的访问
- ✅ 简单球员管理（仅姓名）

### **第一版核心功能** 🎯 (MVP)

#### 1. 无认证的局创建
- 局主直接创建局（无需注册/登录）
- 选择球馆、时间、最大人数
- 给自己起名字并加入局
- 自动生成分享链接

#### 2. 分享链接功能
- 生成唯一的局链接
- 支持微信/WhatsApp分享
- 链接格式：`/join/{sessionId}`
- 链接有效期管理

#### 3. 简单加入机制
- 点击链接进入局页面
- 输入姓名即可加入
- 实时显示参与者列表
- 无需账号验证

### Phase 1: 第一版核心功能 ⭐⭐⭐ (当前重点)
#### 1.1 局创建和分享
- [ ] 无认证的局创建界面
- [ ] 球馆选择和时间设置
- [ ] 局主信息录入（仅姓名）
- [ ] 自动生成分享链接
- [ ] 微信/WhatsApp分享功能

#### 1.2 链接加入功能
- [ ] 链接解析和局信息获取
- [ ] 球员姓名录入界面
- [ ] 加入局的确认机制
- [ ] 参与者列表实时更新
- [ ] 链接有效期验证

#### 1.3 基础数据管理
- [ ] 简化版Session数据结构
- [ ] 球员信息存储（仅姓名）
- [ ] 局状态管理
- [ ] 基础的API路由

### Phase 2: 基础管理功能 ⭐⭐
#### 2.1 权限管理系统
- [ ] 局主 vs 队员权限验证
- [ ] API 权限中间件
- [ ] 前端权限 UI 控制
- [ ] 权限错误处理

#### 2.2 球员状态管理
- [ ] 申请"歇一下"功能（15分钟暂停）
- [ ] 申请"离场"功能（永久离开）
- [ ] 局主审核机制
- [ ] 状态变更通知

#### 2.3 配对管理
- [ ] 基础配对算法
- [ ] 手动配对调整
- [ ] 配对历史记录
- [ ] 配对建议功能

### Phase 3: 高级功能 ⭐
#### 3.1 组局系统
- [ ] 局创建和配置
- [ ] 局分享链接生成
- [ ] 微信/WhatsApp 分享
- [ ] 局搜索和发现

#### 3.2 大分记录系统
- [ ] 2-0/2-1 结果记录
- [ ] 权限验证（队员只能记录自己比赛）
- [ ] 局主审核机制
- [ ] 结果统计更新

#### 3.3 实时同步
- [ ] Socket.io 实时通信
- [ ] 离线数据同步
- [ ] 冲突解决机制
- [ ] 多设备数据一致性

### Phase 4: 统计和优化 ⭐
#### 4.1 统计功能
- [ ] 个人胜负统计
- [ ] 胜率计算
- [ ] 排名系统
- [ ] 数据导出功能

#### 4.2 性能优化
- [ ] 数据库查询优化
- [ ] Redis 缓存策略
- [ ] 前端性能优化
- [ ] 移动端优化

#### 4.3 测试和部署
- [ ] 单元测试覆盖
- [ ] 集成测试
- [ ] 用户接受测试
- [ ] 生产环境部署

## 📊 开发优先级排序

### 🔥 高优先级（必须完成）
1. **轮换算法引擎** - 核心业务逻辑
2. **权限管理系统** - 安全和用户体验
3. **球员状态管理** - 基础交互功能
4. **实时轮换显示** - 用户核心需求

### 📈 中优先级（重要功能）
1. **组局系统** - 用户获取和留存
2. **大分记录系统** - 数据完整性
3. **配对管理** - 提升用户体验
4. **基础统计** - 用户反馈

### 🌟 低优先级（锦上添花）
1. **高级统计** - 数据分析
2. **性能优化** - 技术债务
3. **完整测试** - 质量保证
4. **部署优化** - 运维效率

## 🎯 第一版MVP范围

### ✅ MVP包含功能
1. **简化局管理** - 无需登录，直接创建局
2. **分享链接** - 生成可分享的局链接
3. **简单加入** - 通过链接加入，输入姓名即可
4. **基础轮换** - 简单的轮换算法（5-8人规则）
5. **实时显示** - 参与者列表和轮换状态

### ⏳ 后续版本功能（第二版开始）
1. **用户认证** - 注册/登录系统
2. **权限管理** - 局主vs队员权限
3. **高级轮换** - 复杂的轮换算法和优先级
4. **大分记录** - 2-0、2-1结果记录
5. **统计功能** - 胜率、排名等数据分析
6. **离线同步** - 离线操作和数据同步

## 📈 成功指标

### 第一版MVP指标
- **易用性**: 95%+ 用户能在2分钟内创建局并分享
- **参与率**: 90%+ 收到链接的用户成功加入
- **轮换准确性**: 95%+ 轮换规则正确执行
- **用户满意度**: 85%+ 用户认可基本功能

### 技术指标
- **响应速度**: <500ms 页面加载和操作响应
- **链接有效性**: 99%+ 分享链接正常工作
- **系统稳定**: 99%+ 可用性
- **数据完整性**: 100% 局和球员数据准确性

---

**第一版MVP说明**:
这是一个羽毛球配对管理应用的第一版PRD，采用"简化可用"的策略，快速实现核心价值：

🎯 **核心**: 简化轮换算法（5-8人规则）
📱 **易用**: 无需注册，分享链接即可加入
⚡ **快速**: 2分钟内完成局创建和分享
👥 **社交**: 微信/WhatsApp一键分享

**开发策略**: 先实现MVP验证核心需求，第二版再加入用户认证、权限管理、大分记录等高级功能。

这个PRD可以直接进入开发实施，快速推出第一版产品。